<link rel="stylesheet" href="/styles/cartinhas/escrever-cartinha.css">

<div class="container-escrever">
    <div class="card-cartinha">
        <div class="header-cartinha">
            <h5 class="mb-0">âœ‰ï¸ Nova Cartinha</h5>
        </div>
        
        <div class="corpo-cartinha">
            <form id="formCartinha">
                <!-- Para -->
                <div class="campo campo-destinatario mb-3">
                    <label class="form-label fw-bold">ğŸ“® Para:</label>
                    <div class="input-group">
                        <input type="text" 
                                class="form-control input-destinatario" 
                                id="destinatario" 
                                placeholder="Nome do destinatÃ¡rio"
                                autocomplete="off">
                        <button type="button" class="btn btn-outline-primary" id="btnBuscarUsuarios" title="Buscar usuÃ¡rios">
                            ğŸ”
                        </button>
                    </div>
                    <div id="sugestoesUsuarios" class="sugestoes-usuarios"></div>
                    <input type="hidden" id="destinatarioId" name="destinatarioId">
                </div>

                <!-- Assunto -->
                <div class="campo campo-titulo mb-3">
                    <label class="form-label fw-bold">âœï¸ Assunto:</label>
                    <input type="text" 
                            class="form-control" 
                            id="titulo" 
                            name="titulo"
                            placeholder="Sobre o que vocÃª quer falar?"
                            maxlength="40">
                    <small class="text-muted contador-titulo">0/40 caracteres</small>
                </div>

                <!-- Mensagem -->
                <div class="campo campo-mensagem mb-3">
                    <label class="form-label fw-bold">ğŸ’­ Mensagem:</label>
                    <div class="papel-carta">
                        <div class="linha-margem"></div>
                        <textarea class="form-control textarea-cartinha" 
                                    id="conteudo" 
                                    name="conteudo"
                                    placeholder="Escreva sua mensagem aqui...&#10;&#10;Conte sobre seu dia, compartilhe um pensamento, ou simplesmente diga olÃ¡! âœ¨"
                                    maxlength="560"
                                    rows="12"></textarea>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-1">
                        <small class="text-muted contador-conteudo">0/560 caracteres</small>
                        <div class="assinatura-preview">
                            <small class="text-muted fst-italic">Com carinho, <strong id="nomeRemetente">VocÃª</strong> ğŸ’•</small>
                        </div>
                    </div>
                </div>

                <!-- BotÃµes de AÃ§Ã£o -->
                <div class="acoes-cartinha">
                    <div class="d-flex gap-2 flex-wrap">
                        <button type="button" class="btn btn-outline-secondary" id="btnGerenciarRascunhos" title="Ver rascunhos salvos">
                            ğŸ“ Rascunhos
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="btnSalvarRascunho" title="Salvar como rascunho (Ctrl+S)">
                            ğŸ’¾ Salvar
                        </button>
                        <button type="button" class="btn btn-outline-danger" id="btnLimparCartinha" title="Limpar tudo">
                            ğŸ—‘ï¸ Limpar
                        </button>
                        <div class="ms-auto">
                            <button type="button" class="btn btn-primary btn-lg" id="btnEnviarCartinha" title="Enviar cartinha (Ctrl+Enter)">
                                âœ‰ï¸ Enviar Cartinha
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal de ConfirmaÃ§Ã£o de Envio -->
<div class="modal fade" id="modalConfirmacao" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content modal-cartinha-confirmacao">
            <div class="modal-header">
                <h5 class="modal-title">ğŸ“® Confirmar Envio</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="resumo-envio">
                    <p><strong>Para:</strong> <span id="resumoDestinatario">-</span></p>
                    <p><strong>Assunto:</strong> <span id="resumoTitulo">-</span></p>
                    <p><strong>Mensagem:</strong></p>
                    <div class="resumo-conteudo" id="resumoConteudo">-</div>
                </div>
                <div class="alert alert-info mt-3">
                    <small>âœ¨ Sua cartinha serÃ¡ entregue imediatamente e o destinatÃ¡rio receberÃ¡ uma notificaÃ§Ã£o!</small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnConfirmarEnvio">
                    âœ‰ï¸ Confirmar Envio
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Sucesso -->
<div class="modal fade" id="modalSucesso" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content modal-sucesso">
            <div class="modal-body text-center py-4">
                <div class="icone-sucesso mb-3">ğŸ‰</div>
                <h4 class="titulo-sucesso">Cartinha Enviada!</h4>
                <p class="texto-sucesso">Sua cartinha foi entregue com sucesso e estÃ¡ a caminho do destinatÃ¡rio! ğŸ’Œ</p>
                <div class="botoes-sucesso mt-4">
                    <button type="button" class="btn btn-outline-secondary me-2" onclick="window.location.reload()">
                        âœ‰ï¸ Escrever Outra
                    </button>
                    <button type="button" class="btn btn-outline-primary me-2" onclick="window.location.href='/cartinhas/enviadas'">
                        ğŸ“¤ Ver Enviadas
                    </button>
                    <button type="button" class="btn btn-primary" onclick="window.location.href='/cartinhas/recebidas'">
                        ğŸ“¬ Ver Recebidas
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Salvar Rascunho -->
<div class="modal fade" id="modalSalvarRascunho" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ğŸ’¾ Salvar Rascunho</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="nomeRascunho" class="form-label">Nome do rascunho:</label>
                    <input type="text" class="form-control" id="nomeRascunho" placeholder="Ex: Carta para JoÃ£o, Mensagem de aniversÃ¡rio...">
                    <small class="text-muted">Se deixar em branco, serÃ¡ usado o tÃ­tulo da cartinha ou "Rascunho sem tÃ­tulo"</small>
                </div>
                <div class="resumo-rascunho">
                    <p><strong>Para:</strong> <span id="resumoRascunhoDestinatario">-</span></p>
                    <p><strong>TÃ­tulo:</strong> <span id="resumoRascunhoTitulo">-</span></p>
                    <p><strong>ConteÃºdo:</strong> <span id="resumoRascunhoConteudo">-</span> caracteres</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnConfirmarSalvarRascunho">
                    ğŸ’¾ Salvar Rascunho
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Gerenciar Rascunhos -->
<div class="modal fade" id="modalRascunhos" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ğŸ“ Meus Rascunhos</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="listaRascunhos" class="lista-rascunhos">
                    <!-- Rascunhos serÃ£o carregados aqui -->
                </div>
                <div id="semRascunhos" class="text-center py-4 text-muted" style="display: none;">
                    ğŸ“ Nenhum rascunho salvo ainda.<br>
                    <small>Comece a escrever e clique em "Salvar Rascunho" para guardar suas ideias!</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de ConfirmaÃ§Ã£o para Limpar Cartinha -->
<div class="modal fade" id="modalLimparCartinha" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ğŸ—‘ï¸ Limpar Cartinha</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="text-center mb-3">
                    <div class="display-1">âš ï¸</div>
                </div>
                <p class="text-center"><strong>Tem certeza que deseja limpar toda a cartinha?</strong></p>
                <p class="text-muted text-center">
                    Esta aÃ§Ã£o irÃ¡ apagar:
                </p>
                <ul class="list-unstyled text-center">
                    <li>ğŸ“® DestinatÃ¡rio selecionado</li>
                    <li>ğŸ“ TÃ­tulo da cartinha</li>
                    <li>ğŸ’­ ConteÃºdo da mensagem</li>
                </ul>
                <div class="alert alert-warning text-center">
                    <small>ğŸ’¡ <strong>Dica:</strong> Se quiser guardar o conteÃºdo atual, clique em "Cancelar" e salve um rascunho primeiro!</small>
                </div>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" id="btnConfirmarLimpar">
                    ğŸ—‘ï¸ Sim, Limpar Tudo
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modais necessÃ¡rios -->
<%- include('../../utils/modal-aviso') %>
<%- include('../../utils/modal-confirmacao') %>

<script src="/js/escrever-cartinha.js"></script>